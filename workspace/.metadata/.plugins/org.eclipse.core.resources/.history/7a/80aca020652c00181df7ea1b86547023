package paquete;

import java.util.ArrayList;

public class ID3 {
	private Arbol arbol;

	public ID3 (Tabla tablaInicial) {
		arbol = new Arbol ();
		Nodo nodo = new Nodo();
		nodo.setTabla(tablaInicial);
		algoritmoID3 (nodo, 0);
	}
	
	public void algoritmoID3 (Nodo nodo, int posicion) {
		//Añadimos el nodo al arbol
		arbol.addNodo(nodo);
		/*
		 Si la tabla no tiene elementos, significa que no hay datos suficientes
		 Se acabo el camino, no hay hijos y el resultado es que no hay datos posibles para dar una resolución
		 */
		if(!nodo.getTabla().tieneDatos()) {
			nodo.setResultado("No hay datos");
		}

		/*
		 En caso de que si haya datos, y todos ellos la decisión sea sí o no, entonces también se termina
		 el camino, y su resultado será aquel que se repita en todos (sí o no)
		 */
		else if (nodo.getTabla().getValorDecisionTabla() != null) {
			nodo.setResultado(nodo.getTabla().getValorDecisionTabla());
		}

		/*
		 En este caso, la tabla tiene datos y algunos la decisión es sí y en otros la decisión es no.
		 Por lo tanto, hay que repetir el algoritmo ID3. Para ello, primero se obtiene el atributo con
		 menor merito de la tabla, y por cada valor que tenga ese atributo (en caso de tiempo exterior, 
		 seria soleado, nublado y lluvioso) se crea un nuevo nodo en el árbol y se vuelve a llamar al ID3
		 para que repita todo el proceso
		 */
		else {
			String atributoMenorMerito = nodo.getTabla().atributoMenorMerito();
			nodo.setResultado(atributoMenorMerito);
			ArrayList<String> opciones = nodo.getTabla().getPosibilidades(atributoMenorMerito);
			
			for (String opcion : opciones) {
				Nodo aux = new Nodo();
				aux.setCamino(opcion);
				aux.setPadre(posicion);
				nodo.addHijo(arbol.size());
				aux.setTabla(nodo.getTabla().getNuevaTabla(atributoMenorMerito, opcion));
				this.algoritmoID3(aux, arbol.size());
			}
		}
		// END
		
	}
	
	public String determinar (String tiempoExterior, String temperatura, String humedad, String viento) {
		Nodo aux = arbol.getNodo(0);
		
		while (!aux.getResultado().equals("si") && !aux.getResultado().equals("no") && !aux.getResultado().equals("No hay dato")) {
			aux = arbol.getNodo(determinarSiguienteNodo (tiempoExterior, temperatura, humedad, viento, aux));
		}
		return aux.getResultado();
	}
	
	private int determinarSiguienteNodo (String tiempoExterior, String temperatura, String humedad, String viento, Nodo nodo) {
		if(nodo.getResultado().equals("TiempoExterior")) {
			return determinarHijo (tiempoExterior, nodo);
		}
		else if(nodo.getResultado().equals("Temperatura")) {
			return determinarHijo (temperatura, nodo);
		}
		else if(nodo.getResultado().equals("Humedad")) {
			return determinarHijo (humedad, nodo);
		}
		else if(nodo.getResultado().equals("Viento")) {
			return determinarHijo (viento, nodo);
		}
		return -1;
	}
	
	private int determinarHijo (String atributo, Nodo nodo) {
		for (int hijo: nodo.getHijos()) {
			if (arbol.getNodo(hijo).getCamino().equals(atributo)) {
				return hijo;
			}
		}
		return -1;
	}
	
	public Arbol getArbol () {
		return arbol;
	}
}
